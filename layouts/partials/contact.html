<div class="container" id="contact">

    <div class="row">
        <div class="col-md-8">

            <section>

                {{ .Content }}

                {{ if isset .Site.Params "formspree_action" }}

                <div class="heading">
                  <h3>{{ i18n "contactForm" }}</h3>
                </div>

                <div id="contact-message">By submitting this form, you agree to our <a href="/privacy-policy">privacy policy</a>.<br /><br /></div>

                <form {{ with .Site.Params.contact_form_ajax }}class="contact-form-ajax"{{ else }}{{ end }} id="contact-form" method="post" action="{{ .Site.Params.formspree_action }}?redirect_path=/contact">
                    <input type="hidden" id="subject" name="subject" value="Message from VCC Website">
                    <input type="hidden" id="from_address" name="from_address">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                              <label for="name">{{ i18n "contactName" }}</label>
                                <input type="text" class="form-control" id="name" required minlength="3" maxlength="100">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="email">{{ i18n "contactMail" }}</label>
                                <input type="email" autocomplete="email" class="form-control" id="email" required minlength="5" maxlength="100">
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="form-group">
                              <label for="message">{{ i18n "contactMessage" }}</label>
                                <textarea id="message" class="form-control" name="body" required minlength="50" maxlength="1000"></textarea>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="imhumane-challenge imhumane-responsive"></div>
                        </div>
                        <div class="col-sm-6 text-center">
                          <button type="submit" class="btn btn-template-main" style="display: none;"><i class="far fa-envelope"></i>{{ i18n "contactSend" }}</button>

                        </div>
                    </div>
                    <!-- /.row -->
                </form>

                <script type="text/javascript">
                    const form = document.getElementById("contact-form");
                    const params = new URL(document.location).searchParams;

                    const IMHUMANE_API_URL = "/api/imhumane";
                    const IMHUMANE_APPEND_QUERY = true;
                    const success = params.get("mailform_success");

                    if (success !== null) {
                        form.remove();
                        const msg = document.getElementById("contact-message");
                        const txt =
                            (success === "true")
                            ? "Form submitted successfully. We will respond as soon as we can."
                            : "Failed to submit the form.";
                        msg.innerText = txt;
                    }

                    function update_from_address() {
                        const from_address_field = form.querySelector("#from_address");
                        const name_field = form.querySelector("#name");
                        const email_field = form.querySelector("#email");
                        from_address_field.value = `${name_field.value} <${email_field.value}>`;
                    }

                    form.addEventListener("change", update_from_address);

                    const submit = form.querySelector("button[type='submit']");
                    submit.disabled = true;

                    const imhumane = form.querySelector(".imhumane-challenge");

                    imhumane.addEventListener("imhumane-success", () => {
                        submit.style.display = "inline-block";
                        submit.disabled = false;
                        setTimeout(() => {
                            imhumane.parentElement.innerHTML = "<p>Click this button to send your message:</p>"
                        }, 3000);
                    });

                </script>
                <script type="text/javascript" src="/api/imhumane/v1/static/challenge.js"></script>

                {{ end }}

            </section>

        </div>

        <div class="col-md-4">

            {{ if isset .Site.Params "address" }}
            <section>

              <h3 class="text-uppercase"> {{ i18n "contactAddrTitle" }}</h3>

                {{ .Site.Params.address | safeHTML }}

            </section>

            {{ end }}

        </div>

    </div>
    <!-- /.row -->
</div>

{{ partial "map.html" . }}
